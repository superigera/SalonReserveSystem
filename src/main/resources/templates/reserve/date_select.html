<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<link href='../../lib/main.css' rel='stylesheet' />
<script src='../../lib/main.js'></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<title>予約確認画面</title>
<style>
body {
	background-image:
		url("https://boccitabi.net/photostock/wp-content/uploads/2021/04/4472830_s_1024.jpg");
	background-size: cover;
}

input {
	border-radius: 30px;
	line-height: 30px;
	width: 350px;
	border-radius: 30px;
	margin:auto;
}

div.flex {
	display: flex;
	justify-content: space-between;
}

button {
	border: solid;
	border-color: #80a491;
	border-radius: 10px;
	background: transparent;
	color: #80a491;
}


</style>
</head>
<body>
	<div layout:fragment="content">
		<!-- 選択しているメニュー -->
		<div class="flex"  style="display: flex; margin-top: 30px; margin-left: 30px; border-radius: 10px;">
			<table border="3" style="display: flex; background-color: #ffffff; border-radius: 10px ">
				<tr>
					<th>選択しているメニュー　</th>
					<th>メニュー名　</th>
					<th>料金　</th>
					<th>所要時間目安　</th>
				<tr>
				<form name="reserve_info" th:action="@{/reserve/input_info}" method="post" th:object="${menu}">
					<tr th:each="menu_item:${menu}">
						<td></td>
							<input type="hidden" th:field="${menu.menu_id}" th:value="${menu.menu_id}"> 
						<td th:text="${menu_item.menu_name}"></td>
							<input type="hidden" th:field="${menu.menu_name}" th:value="${menu.menu_name}"> 
						<td th:text="${menu_item.menu_price}"></td>
							<input type="hidden" th:field="${menu.menu_price}" th:value="${menu.menu_price}"> 
						<td th:text="${menu_item.menu_times}"></td>
							<input type="hidden" th:field="${menu.menu_times}" th:value="${menu.menu_times}"> 
						<input id= reserve_date type="hidden" name="reserve_date"> 
						<input id= time type="hidden" name="time"> 
					</tr>
				</form>

			</table>
			<!-- 戻るボタン -->
			<form th:action="@{/reserve/new_reserve}" method="get">
				<button type="submit" style="background-color: #ffffff; margin-right: 10px; padding: 10px; border-radius: 10px; ">メニュー選択に戻る</button>
			</form>

		</div>
		<div id='calendar' style="margin: auto; width: 1000px; background-color: #ffffff; margin-top: 20px"></div>

		<!-- カレンダー -->
		<script th:inline="javascript">
			document.addEventListener('DOMContentLoaded', function() {

				$.ajax({
					  type: "GET",
					  url: "http://localhost:8080/ajax_reserve",
					  data: {
						  menu_time: /*[[${menu.menu_times}]]*/
					  },
					  
					  success: function (result) {
					    
					    var calendarEl = document.getElementById('calendar');
						var date_start = new Date;
						
						var calendar = new FullCalendar.Calendar(calendarEl, {
							dateClick: function(info) {
								const selectDay = info.dateStr.substr(0,4) + info.dateStr.substr(5,2) + info.dateStr.substr(8,2)
								const confirmDay = info.dateStr.substr(0,4) + "年" + info.dateStr.substr(5,2) + "月" + info.dateStr.substr(8,2) + "日"
								const selectTime = info.dateStr.substr(11,5)
								if(confirm(confirmDay + selectTime +"に予約をしますか?")){
									document.getElementById("reserve_date").setAttribute("value", selectDay)
									document.getElementById("time").setAttribute("value", selectTime)
									document.reserve_info.submit()
								}
							},
							
							events:result,
							  
							initialView: 'timeGridWeek',
							locale: 'ja',
							height: '500px',
							
							headerToolbar: {
								left : 'prev',
								center : 'title',
								right : 'next'
							},
							
							views: {
							  timeGridWeek: {
							    slotMinTime: '09:00:00',
							    slotMaxTime: '19:00:00'
							  },
							  timeGridDay: {
							    slotMinTime: '09:00:00',
							    slotMaxTime: '19:00:00'
							  }
							},
							validRange:{
				                start: date_start
							},
							contentHeight: 'auto',
							allDaySlot: false,
							
						});
						calendar.render();
					  }
					});
				
				
			});
		</script>

	</div>
</body>
</html>
